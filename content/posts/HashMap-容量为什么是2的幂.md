---
title: "HashMap 容量为什么是2的幂"
date: 2020-07-11T16:00:33+08:00
draft: false
---

## HashMap总桶的容量

在初始化HashMap时，桶的容量为2的幂；

当HashMap桶的容量不够进行扩容时，桶的容量也是2的幂。

## 为什么会这样呢？

当我们put一个值到HashMap时，会有如下步骤：
1. 计算key的hashcode；
2. 依据key的hashcode决定存储位置，会对hashcode取余；
3. 将key-value放入桶。

在进行第2步时，HashMap不是使用`%`进行取余，而是`index = (n - 1) & hash`

可以这样理解：

当n为2的幂时，比如n=8，二进制表示为`1000`，所以（n-1）的二进制为`0111`，进行&操作时，能快速的丢弃除后三位的所有1
这样就不用取余计算了，我们知道取余计算是乘法运算，与位运算相比，位运算更加快速。
